{"updatedAt":"2025-11-01T15:31:42.139Z","createdAt":"2025-10-31T19:27:01.761Z","id":"ptLQdXyDtMxoVW51","name":"Onboarding and Clothing Selection","active":true,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"=https://api.telegram.org/bot{{ $json.token }}/setWebhook","sendBody":true,"specifyBody":"json","jsonBody":"={\"url\":\"{{ $json.url }}{{ $json.token }}\",\"allowed_updates\":[\"message\",\"edited_message\",\"channel_post\",\"edited_channel_post\",\"inline_query\",\"chosen_inline_result\",\"callback_query\",\"shipping_query\",\"pre_checkout_query\",\"poll\",\"poll_answer\",\"my_chat_member\",\"chat_member\",\"chat_join_request\"]}","options":{"redirect":{"redirect":{}}}},"id":"3315e61d-f888-4997-b99c-01cd11002163","name":"HTTP Request4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[280,20]},{"parameters":{"mode":"raw","jsonOutput":"={{ $json.body.toJsonString() }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[80,340],"id":"a7159aaa-5823-491c-a460-f609382e00dc","name":"Telegram Trigger1"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-140,20],"id":"e59c32c4-c085-4b11-bf82-d937dbfd2272","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfunction handleTelegramWebhook(update) {\n\n    const normalized = {\n        text: null,\n        event: null,\n        user_id: null,\n        message_id: null,\n        file_id: null,\n        file_type: null,\n        raw_data: update, \n        user_data: null // –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    };\n\n    // Handle message updates\n    if (update.message) {\n        const msg = update.message;\n        normalized.message_id = msg.message_id;\n        normalized.user_id = msg.from.id;\n        normalized.user_data = {\n            user_id: msg.from.id,\n            first_name: msg.from.first_name,\n            last_name: msg.from.last_name,\n            user_name: msg.from.username\n        };\n\n        // Handle text messages\n        if (msg.text) {          \n            if(msg.text.startsWith(\"/start\") && msg.text.split(' ').length > 1) {              \n            normalized.text = msg.text.split(' ')[1];\n            } else {              \n              normalized.text = msg.text;\n            }            \n            normalized.event = 'text_message';\n        } else if(msg.new_chat_member) {\n            normalized.text = 'message new_chat_member';\n        } else if(msg.left_chat_member) {\n            normalized.text = 'message left_chat_member';\n        }\n        // Handle photo messages\n        else if (msg.photo) {\n            normalized.text = msg.caption || 'new photo message';\n            normalized.event = 'photo_message';\n            normalized.file_id = msg.photo[msg.photo.length - 1].file_id;\n            normalized.file_type = 'photo';\n        }\n        // Handle video messages\n        else if (msg.video) {\n            normalized.text = msg.caption || 'new video message';\n            normalized.event = 'video_message';\n            normalized.file_id = msg.video.file_id;\n            normalized.file_type = 'video';\n        }\n        // Handle document messages\n        else if (msg.document) {\n            normalized.text = msg.caption || 'new document message';\n            normalized.event = 'document_message';\n            normalized.file_id = msg.document.file_id;\n            normalized.file_type = 'document';\n        }\n        // Handle voice messages\n        else if (msg.voice) {\n            normalized.text = msg.caption || 'new voice message';\n            normalized.event = 'voice_message';\n            normalized.file_id = msg.voice.file_id;\n            normalized.file_type = 'voice';\n        }\n        // Handle audio messages\n        else if (msg.audio) {\n            normalized.text = msg.caption || 'new audio message';\n            normalized.event = 'audio_message';\n            normalized.file_id = msg.audio.file_id;\n            normalized.file_type = 'audio';\n        }\n        // Handle location messages\n        else if (msg.location) {\n            normalized.text = 'new location message ' + msg.location.latitude + ' ' + msg.location.longitude;\n            normalized.event = 'location_message';\n        }\n        // Handle contact messages\n        else if (msg.contact) {\n            normalized.text = 'new contact message ' + msg.contact.phone_number;\n            normalized.event = 'contact_message';\n        }\n    }\n    // Handle callback queries\n    else if (update.callback_query) {\n        const cb = update.callback_query;\n        normalized.text = cb.data;\n        normalized.event = 'callback_query';\n        normalized.user_id = cb.from.id;\n        normalized.message_id = cb.message.message_id;\n        normalized.user_data = {\n            user_id: cb.from.id,\n            first_name: cb.from.first_name,\n            last_name: cb.from.last_name,\n            user_name: cb.from.username\n        };\n    }\n    // Handle channel posts\n    else if (update.channel_post) {\n        const post = update.channel_post;\n        normalized.message_id = post.message_id;\n        normalized.user_id = post.chat.id;\n\n        if (post.text) {\n            normalized.text = post.text;\n            normalized.event = 'channel_post';\n        }\n    }\n    // Handle edited messages\n    else if (update.edited_message) {\n        const msg = update.edited_message;\n        normalized.message_id = msg.message_id;\n        normalized.user_id = msg.from.id;\n        normalized.user_data = {\n            user_id: msg.from.id,\n            first_name: msg.from.first_name,\n            last_name: msg.from.last_name,\n            user_name: msg.from.username\n        };\n\n        if (msg.text) {\n            normalized.text = msg.text;\n            normalized.event = 'edited_message';\n        }\n    }\n    // Handle inline queries\n    else if (update.inline_query) {\n        const query = update.inline_query;\n        normalized.text = query.query;\n        normalized.event = 'inline_query';\n        normalized.user_id = query.from.id;\n        normalized.user_data = {\n            user_id: query.from.id,\n            first_name: query.from.first_name,\n            last_name: query.from.last_name,\n            user_name: query.from.username\n        };\n    }\n    // Handle chosen inline results\n    else if (update.chosen_inline_result) {\n        const result = update.chosen_inline_result;\n        normalized.text = result.query;\n        normalized.event = 'chosen_inline_result';\n        normalized.user_id = result.from.id;\n        normalized.user_data = {\n            user_id: result.from.id,\n            first_name: result.from.first_name,\n            last_name: result.from.last_name,\n            user_name: result.from.username\n        };\n    }\n    // Handle poll answers\n    else if (update.poll_answer) {\n        const poll = update.poll_answer;\n        normalized.event = 'poll_answer';\n        normalized.user_id = poll.user.id;\n        normalized.user_data = {\n            user_id: poll.user.id,\n            first_name: poll.user.first_name,\n            last_name: poll.user.last_name,\n            user_name: poll.user.username\n        };\n    }\n    // Handle my chat member updates\n    else if (update.my_chat_member) {\n        const member = update.my_chat_member;\n        normalized.event = 'my_chat_member';\n        normalized.user_id = member.from.id;\n        normalized.user_data = {\n            user_id: member.from.id,\n            first_name: member.from.first_name,\n            last_name: member.from.last_name,\n            user_name: member.from.username\n        };\n    }\n    // Handle chat member updates\n    else if (update.chat_member) {\n        const member = update.chat_member;\n        normalized.event = 'chat_member';\n        normalized.user_id = member.from.id;\n        normalized.user_data = {\n            user_id: member.from.id,\n            first_name: member.from.first_name,\n            last_name: member.from.last_name,\n            user_name: member.from.username\n        };\n    }\n\n    return normalized;\n}\n\nreturn [handleTelegramWebhook($input.first().json)];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[280,340],"id":"dfeca39b-7b92-435b-b0c4-c2a5799899d3","name":"update"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.text }}","rightValue":"/start","operator":{"type":"string","operation":"equals"},"id":"15aca3db-f35e-4df2-9fac-157f5b901d0a"}],"combinator":"and"},"renameOutput":true,"outputKey":"start"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e39e82f4-5b33-44ac-bd62-7eb6a79795d4","leftValue":"={{ $json.text }}","rightValue":"item_","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ef193d17-c600-4c2b-b679-2a75e0db3d96","leftValue":"={{ $json.event }}","rightValue":"photo_message","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"photo"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"25297ca2-cb1a-43a1-9a4d-ad700188c3ce","leftValue":"={{ $json.event }}","rightValue":"text_message","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"default"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7fc4f5d5-de36-4afd-ae3b-2b072bcda164","leftValue":"={{ $json.event }}","rightValue":"callback_query","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"callback"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[520,340],"id":"5220ca51-9f35-49ea-b46f-28c4f16dd8ca","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"8b8dbe23-8435-4f82-937f-170b4ff3bea5","name":"token","value":"8454907131:AAGLS4rB-Z0LU4w2SsSjpeQAEsO5sRLfghw","type":"string"},{"id":"bfdaefe5-cd53-430c-ac79-2d173e44072e","name":"url","value":"https://n8n.ai-lowcode.dev/webhook/98a56513-8d62-4dc5-bbf1-051d4cd245b2/","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[60,20],"id":"949dcc79-4e31-48ca-9a79-db76cc312c35","name":"token_weddingdress"},{"parameters":{"httpMethod":"POST","path":":token","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-140,340],"id":"7112bddf-dcaf-43e1-af5b-e629a2e9a238","name":"Webhook","webhookId":"98a56513-8d62-4dc5-bbf1-051d4cd245b2"},{"parameters":{"chatId":"={{ $json.raw_data.message.chat.id }}","text":"=–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø—Ä–∏–º–µ—Ä–æ—á–Ω—É—é! ‚ú®\n\n–ü–æ–¥–±–µ—Ä–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–π –Ω–∞—Ä—è–¥ –¥–ª—è –≤–∞—à–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ –¥–Ω—è. –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç: —Å–≤–∞–¥–µ–±–Ω—ã–µ –ø–ª–∞—Ç—å—è –∏–ª–∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–µ –∫–æ—Å—Ç—é–º—ã?","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"üë∞‚Äç‚ôÄÔ∏è –°–≤–∞–¥–µ–±–Ω—ã–µ –ø–ª–∞—Ç—å—è","additionalFields":{"callback_data":"category_dress"}},{"text":"ü§µ‚Äç‚ôÇÔ∏è –ö–æ—Å—Ç—é–º—ã","additionalFields":{"callback_data":"category_suit"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[660,-520],"id":"c60c7e02-8df8-4389-9e34-6dfa6659e41e","name":"Send welcome","webhookId":"1ace5b6a-b30c-47d0-bfae-4d6fd2b378bd","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.text }}","rightValue":"category_dress","operator":{"type":"string","operation":"equals"},"id":"e7fb7762-f6a6-4cae-b68c-f95ee40b5af4"}],"combinator":"and"},"renameOutput":true,"outputKey":"dress"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bc65dcee-749d-4231-bacc-8b09e12240f4","leftValue":"={{ $json.text }}","rightValue":"category_suit","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"suit"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"73a6f16e-9810-4306-a9ef-5ba135401263","leftValue":"={{ $json.text }}","rightValue":"create_video","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"video"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7a7bc03a-0de7-4de4-bfcf-6e84732ea800","leftValue":"={{ $json.text }}","rightValue":"video_","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"vidoe_number"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[860,760],"id":"7d44e824-7175-4569-b3ca-36da1565abba","name":"Switch1"},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appfcL415ShF9dGPA","mode":"list","cachedResultName":"wedding_dress","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA"},"table":{"__rl":true,"value":"tblEWAhYrGPxJgeVT","mode":"list","cachedResultName":"clothes","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA/tblEWAhYrGPxJgeVT"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1040,640],"id":"1ae643c4-a03c-46ed-b348-116f233b3f8f","name":"Get dresses","credentials":{"airtableTokenApi":{"id":"Mwb1i03voej07l1G","name":"Airtable club"}}},{"parameters":{"operation":"search","base":{"__rl":true,"value":"appfcL415ShF9dGPA","mode":"list","cachedResultName":"wedding_dress","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA"},"table":{"__rl":true,"value":"tblEWAhYrGPxJgeVT","mode":"list","cachedResultName":"clothes","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA/tblEWAhYrGPxJgeVT"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1040,820],"id":"e667e724-1f70-4cf4-8edf-c4e44a83c214","name":"Get suits","credentials":{"airtableTokenApi":{"id":"Mwb1i03voej07l1G","name":"Airtable club"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"9ab24155-53f7-47e5-8568-33d2fd4782e0","leftValue":"={{ $json.type }}","rightValue":"suit","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[1240,820],"id":"d060d9ff-ba89-47ce-9a2b-2ba6588cf8d5","name":"suit"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23d137d6-667a-4c92-8723-50c0e40593c1","leftValue":"={{ $json.type }}","rightValue":"dress","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[1220,640],"id":"ab3bc83f-6731-4978-af17-edbfd123480f","name":"dress"},{"parameters":{"jsCode":"const items = $input.all();\nconst message = \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏:\";\nconst keyboard = [];\n\nfor (const item of items) {\n  const fields = item.json.fields;\n  keyboard.push([{\n    text: `${fields.name} - ${fields.price} RUB`,\n    callback_data: `item_${fields.itemId}`\n  }]);\n}\n\nreturn [{\n  json: {\n    message: message,\n    reply_markup: {\n      inline_keyboard: keyboard\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1400,640],"id":"af4c66f7-6cb9-49f2-810e-1d7810b3c334","name":"Code"},{"parameters":{"jsCode":"/const items = $input.all();\nconst message = \"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏:\";\nconst keyboard = [];\n\nfor (const item of items) {\n  const fields = item.json.fields;\n  keyboard.push([{\n    text: `${fields.name} - ${fields.price} RUB`,\n    callback_data: `item_${fields.itemId}`\n  }]);\n}\n\nreturn [{\n  json: {\n    message: message,\n    reply_markup: {\n      inline_keyboard: keyboard\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1420,820],"id":"0f52068f-0f92-4698-a1e1-624a12df0b92","name":"Code1"},{"parameters":{"chatId":"={{$json.callback_query.message.chat.id}}","text":"={{$json.message}}","replyMarkup":"={{$json.reply_markup.inline_keyboard}}","forceReply":{},"replyKeyboardOptions":{},"replyKeyboardRemove":{},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1620,720],"id":"83152735-26e1-48be-af75-6255afb8978e","name":"Send a cataloge","webhookId":"37f3a031-5f54-47aa-8422-6fecae568eff","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"assignments":{"assignments":[{"id":"1be82132-d874-40af-b668-0db77181111f","name":"={{$json.callback_query.data.split('_')[1]}}","value":"item_","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[820,-240],"id":"536adf15-8742-4747-924b-804bbf8ddc9b","name":"Edit Fields"},{"parameters":{"chatId":"={{$json.callback_query.message.chat.id}}","text":"–í—ã –≤—ã–±—Ä–∞–ª–∏ \"{{$node[\"Airtable (–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ)\"].json.fields.Name}}\" \n–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –≤–∞—à–µ —Ñ–æ—Ç–æ –≤ –ø–æ–ª–Ω—ã–π —Ä–æ—Å—Ç. –î–ª—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å—Ç–æ–π—Ç–µ –ø—Ä—è–º–æ, —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–∞–º–µ—Ä—É, –∞ –æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ö–æ—Ä–æ—à–∏–º.","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1160,-240],"id":"4129d7d8-c278-457a-9999-eb361dd9773f","name":"ask for photo","webhookId":"4d6ea3b4-9477-449d-8658-27113bedf4cb","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"assignments":{"assignments":[{"id":"a339b203-42d3-4788-86ee-5fafabbd059f","name":"=file_id","value":"={{ $json.raw_data.message.photo[3].file_id }}","type":"string"},{"id":"6755a455-e626-4508-99ed-08229a7239f8","name":"chat_id","value":"={{ $json.raw_data.message.chat.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[820,380],"id":"861bae7a-2ad8-44e8-9956-ed194f34b0f0","name":"photo"},{"parameters":{"chatId":"={{ $json.chat_id }}","text":"–°–ø–∞—Å–∏–±–æ, —Ñ–æ—Ç–æ –ø—Ä–∏–Ω—è—Ç–æ! üëç \n–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∑–∞–º–µ—Ä—ã –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –†–æ—Å—Ç, –¢–∞–ª–∏—è, –ë–µ–¥—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 170, 75, 95)","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1020,380],"id":"99814e5b-473a-4c02-9b6b-bd5858106a20","name":"ask for tails","webhookId":"85c0c2cb-9b01-4eee-b068-0d41f0c64869","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"base":{"__rl":true,"value":"appfcL415ShF9dGPA","mode":"list","cachedResultName":"wedding_dress","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA"},"table":{"__rl":true,"value":"tblEWAhYrGPxJgeVT","mode":"list","cachedResultName":"clothes","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA/tblEWAhYrGPxJgeVT"},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1000,-240],"id":"65bcf1ac-f989-47ad-a35a-f7e0954d670f","name":"get item","credentials":{"airtableTokenApi":{"id":"Mwb1i03voej07l1G","name":"Airtable club"}}},{"parameters":{"method":"POST","url":"https://api.yookassa.ru/v3/payments","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"amount\": {\n    \"value\": \"250.00\", // <-- –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –¶–ï–ù–ê –£–°–õ–£–ì–ò\n    \"currency\": \"RUB\"\n  },\n  \"confirmation\": {\n    \"type\": \"redirect\",\n    \"return_url\": \"https://t.me/@WeddingDres_bot\"\n  },\n  \"capture\": true,\n  \"description\": \"AI-–ø—Ä–∏–º–µ—Ä–∫–∞: {{$node[\"Airtable (–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ)\"].json.fields.Name}}\",\n  \"metadata\": {\n    \"executionId\": \"{{$execution.id}}\",\n    \"payment_type\": \"image\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1240,380],"id":"7d18808e-f9ce-4c49-ad8e-cf41b6c48393","name":"payment link"},{"parameters":{"content":"Method: POST\nURL: https://api.yookassa.ru/v3/payments\nAuthentication: Generic Credential Type -> HTTP Header Auth\nName: Authorization\nValue: Basic + –≤–∞—à_—Ç–æ–∫–µ–Ω_–≤_base64.\n–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω: –í–æ–∑—å–º–∏—Ç–µ –≤–∞—à shopId –∏ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, —Å–æ–µ–¥–∏–Ω–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–µ (shopId:–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á) –∏ –∑–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç Base64 (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –æ–Ω–ª–∞–π–Ω-–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫).\nHeaders > Add Header:\nName: Idempotence-Key, Value: {{$execution.id}}","height":460,"width":300},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1180,40],"id":"72f4fdcf-cf17-4c70-8286-2a6e44c80fee","name":"Sticky Note"},{"parameters":{"chatId":"={{$node[\"Telegram Trigger\"].json.message.chat.id}}","text":"–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏—Ç–µ —É—Å–ª—É–≥—É –ø–æ —Å—Å—ã–ª–∫–µ.\n–°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 15 –º–∏–Ω—É—Ç.","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"=üí≥ –û–ø–ª–∞—Ç–∏—Ç—å {{$node[\"HTTP Request (–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa)\"].json.amount.value}} RUB","additionalFields":{"url":"={{$node[\"HTTP Request (–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa)\"].json.confirmation.confirmation_url}}"}}]}}]},"additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1520,380],"id":"89d97521-28cb-48db-aec4-ece7f9cf0f3b","name":"Send a payment link","webhookId":"f4ca6f18-1dfd-4dc0-9de5-2b34c9501a3a","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"resume":"webhook","options":{}},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1840,20],"id":"bfed345b-16ea-4769-8901-1c498f25ea39","name":"Wait","webhookId":"6c614a4a-ab21-400c-b5ea-9113cb3fd0d2"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfcL415ShF9dGPA","mode":"list","cachedResultName":"wedding_dress","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA"},"table":{"__rl":true,"value":"tblL9UCTcXZHs7cFU","mode":"list","cachedResultName":"executions","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA/tblL9UCTcXZHs7cFU"},"columns":{"mappingMode":"defineBelow","value":{"executionId":"={{ $execution.id }}","resumeUrl":"={{ $resumeUrl }}","paymentType":"image"},"matchingColumns":[],"schema":[{"id":"executionId","displayName":"executionId","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"resumeUrl","displayName":"resumeUrl","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"paymentType","displayName":"paymentType","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1640,20],"id":"ef243038-9107-4611-84f9-f8921d5cd870","name":"resume url","credentials":{"airtableTokenApi":{"id":"Mwb1i03voej07l1G","name":"Airtable club"}}},{"parameters":{"chatId":"={{$node[\"Telegram Trigger\"].json.message.chat.id}}","text":"‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –ù–∞—á–∏–Ω–∞—é –º–∞–≥–∏—é... \n–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –æ–±—Ä–∞–∑–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2040,0],"id":"7d883f9f-a6ff-4d4c-81f7-2afe36c1c905","name":"paymnet confirmation","webhookId":"c735a466-ecee-4afd-92fa-cad0d7d350c5","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1960,260],"id":"c13ede89-a0a9-4378-b960-cbf8bac34cac","name":"Extract from File1"},{"parameters":{"assignments":{"assignments":[{"id":"16a5d349-2733-496b-a74e-207f5846e809","name":"text","value":"=File uploaded with URL - {{$json.data.url}}","type":"string"},{"id":"23020fa1-59eb-4bd8-9c73-cb2900fbdf50","name":"prompt","value":"A realistic photo of a person wearing the selected outfit, full body shot, 4 different angles.","type":"string"},{"id":"43fb9d3d-2fc2-4046-902c-5414f045d227","name":"aspect_ratio","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1780,520],"id":"db05d285-6f46-4ad8-85c2-58b14b1398ad","name":"Edit Fields12"},{"parameters":{"resource":"file","fileId":"={{ $('Telegram Trigger').item.json.message.photo[3].file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1760,260],"id":"2ebc27a1-0c5b-4161-8d72-1f73ebdc770b","name":"Get a file_id photo","webhookId":"6734da18-d6c3-4e3e-9d3b-7f6b9646e1b2","credentials":{"telegramApi":{"id":"WkhN45nAM0rbsZmf","name":"Telegram club"}}},{"parameters":{"method":"POST","url":"https://api.imgbb.com/1/upload","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiration","value":"6000"},{"name":"key","value":"265fd828261f9f4c8f64f26606ab30ba"}]},"sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"image","value":"={{$json.data}}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2180,260],"id":"e962b36d-4fe1-43ce-8227-4ffd44154417","name":"get public url"},{"parameters":{"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2100,1000],"id":"8c0239ea-267c-4860-a29d-2412deac8117","name":"replicate/seedream"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2940,140],"id":"feb27625-72fe-4c26-a1e0-dac5eab04551","name":"Wait4","webhookId":"a859ba1f-3dc5-4572-80d3-ec57c2201ed6"},{"parameters":{"url":"=https://api.replicate.com/v1/predictions/{{$('Generate Image').item.json.id}}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"options":{"redirect":{"redirect":{}}}},"id":"7325f85f-d23c-4b8a-a48f-ea9d20fd75cc","name":"Get Generation","type":"n8n-nodes-base.httpRequest","position":[3160,140],"retryOnFail":false,"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"failed","operator":{"type":"string","operation":"equals"},"id":"d8d9b5c2-da45-40b3-bcda-354a24e9afb9"}],"combinator":"and"},"renameOutput":true,"outputKey":"failed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7f495a0a-8781-4d4f-a8e0-592190721892","leftValue":"={{ $json.status }}","rightValue":"succeeded","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"completed"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[3440,140],"id":"99aaf5f5-57fb-4b0b-9e1f-8e39765e74df","name":"Switch2"},{"parameters":{"method":"POST","url":"https://api.replicate.com/v1/models/google/imagen-4/predictions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"input\": {\n    \"prompt\": {{ JSON.stringify($json.prompt) }},\n\"aspect_ratio\": \"{{ $json.aspect_ratio }}\"\n  }\n}","options":{"redirect":{"redirect":{}}}},"id":"8f3ec9e9-2478-4043-ad88-0fccbaf9d6b4","name":"Generate Image","type":"n8n-nodes-base.httpRequest","position":[2620,140],"retryOnFail":false,"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"MrrEJOpy1E7t0Je4","name":"Replicate club"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"f628b61b-e000-4b58-a9b7-47f7d1072040","name":"output","value":"={{$('Get Generation').item.json.output}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3760,160],"id":"999b8421-f02b-4db8-bd7c-c6fc3e1d4e02","name":"Edit Fields2"},{"parameters":{"content":"## Generate image with Imagen 4\n\n","height":368,"width":1408},"type":"n8n-nodes-base.stickyNote","position":[2520,40],"typeVersion":1,"id":"0b5fe2b5-7d86-48ba-bf80-6113d4e239b6","name":"Sticky Note1"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2280,540],"id":"40403d32-be64-4d43-a121-2639b3c60828","name":"Wait5","webhookId":"a859ba1f-3dc5-4572-80d3-ec57c2201ed6"},{"parameters":{"url":"=https://api.replicate.com/v1/predictions/{{$('Generate Image1').item.json.id}}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"options":{"redirect":{"redirect":{}}}},"id":"4c348c7b-8db2-437a-bcd9-f89f983e45b9","name":"Get Generation2","type":"n8n-nodes-base.httpRequest","position":[2460,540],"retryOnFail":false,"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"MrrEJOpy1E7t0Je4","name":"Replicate club"}},"onError":"continueErrorOutput"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"failed","operator":{"type":"string","operation":"equals"},"id":"d8d9b5c2-da45-40b3-bcda-354a24e9afb9"}],"combinator":"and"},"renameOutput":true,"outputKey":"failed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7f495a0a-8781-4d4f-a8e0-592190721892","leftValue":"={{ $json.status }}","rightValue":"succeeded","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"completed"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2720,540],"id":"e2077bd8-60c7-445c-b95c-a9043f939296","name":"Switch4"},{"parameters":{"method":"POST","url":"https://api.replicate.com/v1/models/bytedance/seedream-4/predictions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"input\": {\n    \"prompt\": {{ JSON.stringify($json.prompt) }},\n\"aspect_ratio\": \"{{ $json.aspect_ratio }}\",\n\"image_input\": [\n    \"{{$node[\"Set (–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL —Ñ–æ—Ç–æ)\"].json.userPhotoPublicUrl}}\",\"{{$node[\"Airtable (–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ)\"].json.fields.ImageURL}}\"\n  ],\n  \n  \"sequential_image_generation\": \"auto\",\n  \n  \"match_input_image\": true,\n  \"max_images\": 4\n  }\n}","options":{"redirect":{"redirect":{}}}},"id":"1da168a8-fa84-412e-9461-0194d84307fc","name":"Generate Image1","type":"n8n-nodes-base.httpRequest","position":[2020,560],"retryOnFail":false,"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"MrrEJOpy1E7t0Je4","name":"Replicate club"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"f628b61b-e000-4b58-a9b7-47f7d1072040","name":"output","value":"={{$('Get Generation2').item.json.output}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2960,580],"id":"550c5c2c-8be7-4192-a370-90355f07e274","name":"Edit Fields5"},{"parameters":{"content":"## Generate image with Seedream\n","height":336,"width":1184},"type":"n8n-nodes-base.stickyNote","position":[1960,460],"typeVersion":1,"id":"f9ee472b-3005-48a9-a339-1fa52b80fa0e","name":"Sticky Note2"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3180,580],"id":"45f729f9-da89-499d-9b84-a073540b78b5","name":"Split Out"},{"parameters":{"operation":"sendPhoto","chatId":"={{$node[\"Telegram Trigger\"].json.message.chat.id}}","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[3340,580],"id":"f8c69dcb-e1b8-4e81-a8a3-e3eb401807f3","name":"Send Photo","webhookId":"4ae7052a-d94e-46cf-9236-77e9cb95e762","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"chatId":"={{$node[\"Telegram Trigger\"].json.message.chat.id}}","text":"–í–∞—à–∏ –æ–±—Ä–∞–∑—ã –≥–æ—Ç–æ–≤—ã! ‚ú® \n–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é –≤–∏–¥–µ–æ-–∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—É?","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"–î–∞, —Å–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ!","additionalFields":{"callback_data":"create_video"}},{"text":"–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ","additionalFields":{"callback_data":"finish"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[3560,580],"id":"966535f5-20bf-4f45-a5cd-241a86ba8f99","name":"video?","webhookId":"ff699cfb-0708-43e6-a0df-95bb6587b8d7","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"chatId":"={{$json.callback_query.message.chat.id}}","text":"–û—Ç–ª–∏—á–Ω–æ! –ö–∞–∫–æ–µ –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –≤–∏–¥–µ–æ?","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"1","additionalFields":{"callback_data":"video_1"}},{"text":"2","additionalFields":{"callback_data":"video_2"}}]}},{"row":{"buttons":[{"text":"3","additionalFields":{"callback_data":"video_3"}},{"text":"4","additionalFields":{"callback_data":"video_4"}}]}}]},"additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1040,1020],"id":"fc2f49bd-97f8-4d39-bc79-98fbf64cad27","name":"Send a text message","webhookId":"5ddff903-6672-4eed-a143-12cccff671a7","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"assignments":{"assignments":[{"id":"582d43d0-8aa2-4ce1-8674-0766e02dab4f","name":"imageForVideoUrl","value":"={{$node[\"Replicate (–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)\"].json.output[parseInt($json.callback_query.data.split('_')[1]) - 1]}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1060,1220],"id":"02cd1a51-6241-47e5-848f-236bb9c5d259","name":"save url image"},{"parameters":{"content":"Authentication: Generic Credential Type\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ HTTP Header Auth.\nName: Authorization\nValue: Basic –í–ê–®_BASE64_–¢–û–ö–ï–ù\n–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:\n–í–æ–∑—å–º–∏—Ç–µ –≤–∞—à shopId –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ÆKassa.\n–í–æ–∑—å–º–∏—Ç–µ –≤–∞—à –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (Secret Key).\n–°–æ–µ–¥–∏–Ω–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–µ: shopId:–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á. –ù–∞–ø—Ä–∏–º–µ—Ä: 123456:test_abcdefg...\n–ó–∞–∫–æ–¥–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç Base64. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, base64encode.org).\n–ü–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤—Å—Ç–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ Basic (—Å –ø—Ä–æ–±–µ–ª–æ–º).flows/sticky-notes/)","height":340,"width":480},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,1380],"id":"2338c5f9-4e44-4d59-88ce-d498d2c398be","name":"Sticky Note3"},{"parameters":{"chatId":"={{$json.callback_query.message.chat.id}}","text":"–û—Ç–ª–∏—á–Ω–æ! –û—Å—Ç–∞–ª—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥.  –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ-–∞–Ω–∏–º–∞—Ü–∏–∏. –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 15 –º–∏–Ω—É—Ç.","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"üí≥ –û–ø–ª–∞—Ç–∏—Ç—å 350 RUB","additionalFields":{"url":"={{$node[\"HTTP Request (–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –∑–∞ –≤–∏–¥–µ–æ)\"].json.confirmation.confirmation_url}}"}}]}}]},"additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1500,1220],"id":"60588611-a0e4-4385-981f-5b841c2f7c7a","name":"send payment link video","webhookId":"66ba5a90-5296-4770-89da-df1a3aaafe74","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"resume":"webhook","options":{}},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1940,1220],"id":"b4c9f9b3-e398-4b27-b4b9-0aa1a2c3c092","name":"Wait1","webhookId":"73f29ca0-a9bc-44fc-a658-f757c2020247"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appfcL415ShF9dGPA","mode":"list","cachedResultName":"wedding_dress","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA"},"table":{"__rl":true,"value":"tblL9UCTcXZHs7cFU","mode":"list","cachedResultName":"executions","cachedResultUrl":"https://airtable.com/appfcL415ShF9dGPA/tblL9UCTcXZHs7cFU"},"columns":{"mappingMode":"defineBelow","value":{"executionId":"={{$execution.id}}","resumeUrl":"={{$resumeUrl}}","paymentType":"video"},"matchingColumns":[],"schema":[{"id":"executionId","displayName":"executionId","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"resumeUrl","displayName":"resumeUrl","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"paymentType","displayName":"paymentType","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1720,1220],"id":"474f8a46-0669-4fae-9fbd-954f5ecd34a6","name":"Create a record","credentials":{"airtableTokenApi":{"id":"Mwb1i03voej07l1G","name":"Airtable club"}}},{"parameters":{"method":"POST","url":"https://api.yookassa.ru/v3/payments","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Idempotence-Key","value":"={{$execution.id}}-video"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"amount\": {\n    \"value\": \"350.00\",\n    \"currency\": \"RUB\"\n  },\n  \"confirmation\": {\n    \"type\": \"redirect\",\n    \"return_url\": \"https://t.me/@WeddingDres_bot\"\n  },\n  \"capture\": true,\n  \"description\": \"–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ-–∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–∞ #{{$execution.id}}\",\n  \"metadata\": {\n    \"executionId\": \"{{$execution.id}}\",\n    \"payment_type\": \"video\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1280,1220],"id":"9e64a64d-c657-42c6-a3f2-300e2a6eaca8","name":"pay for video link"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"failed","operator":{"type":"string","operation":"equals"},"id":"d8d9b5c2-da45-40b3-bcda-354a24e9afb9"}],"combinator":"and"},"renameOutput":true,"outputKey":"failed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7f495a0a-8781-4d4f-a8e0-592190721892","leftValue":"={{ $json.status }}","rightValue":"succeeded","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"completed"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[4240,1260],"id":"58ce4fcc-a901-4f64-8a44-cb9f2281227b","name":"Switch8"},{"parameters":{"method":"POST","url":"https://api.replicate.com/v1/models/openai/sora-2/predictions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"input\": {\n      \"prompt\": {{ JSON.stringify($('Edit Fields11').item.json.prompt) }},\n      \"seconds\": {{$('Edit Fields11').item.json.duration}},\n      \"aspect_ratio\": \"{{$('Edit Fields11').item.json.aspect_ratio}}\",\n      \"openai_api_key\": \"{{$('Edit Fields11').item.json.openai_api_key}}\",\n\"input_reference\":\"{{ $json.data.url }}\"\n    }\n  }","options":{"redirect":{"redirect":{}}}},"id":"8ec49dd7-440f-4841-ab17-4ef3f912f3ff","name":"Generate Video4","type":"n8n-nodes-base.httpRequest","position":[3220,1300],"retryOnFail":false,"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"MrrEJOpy1E7t0Je4","name":"Replicate club"}},"onError":"continueErrorOutput"},{"parameters":{"amount":15},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3780,1280],"id":"9ca2fd35-d658-4fa9-8203-8c42bc740354","name":"Wait3","webhookId":"a859ba1f-3dc5-4572-80d3-ec57c2201ed6"},{"parameters":{"url":"=https://api.replicate.com/v1/predictions/{{$('Generate Video4').item.json.id}}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Prefer","value":"wait"}]},"options":{"redirect":{"redirect":{}}}},"id":"ce5b81ce-a58c-4118-bca9-bb52fa85577b","name":"Get Generation6","type":"n8n-nodes-base.httpRequest","position":[3940,1280],"retryOnFail":false,"typeVersion":4.2,"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1fc80ba9-84bb-4e39-ad24-8127d7399df6","leftValue":"={{ $json.status }}","rightValue":"failed","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3520,1300],"id":"3c67806e-d489-4bb9-b3ae-60c6703b8b78","name":"If1"},{"parameters":{"url":"={{ $json.input_reference }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2420,1280],"id":"8fcd44c8-24e1-45cb-a21a-f27d999d7422","name":"Download Image"},{"parameters":{"operation":"resize","width":"={{ $json.aspect_ratio==\"portrait\" ? 720 : 1280 }}","height":"={{ $json.aspect_ratio==\"portrait\" ? 1280 : 720 }}","resizeOption":"ignoreAspectRatio","options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[2640,1300],"id":"f6a2cf17-5326-44b5-9d8b-a310b77ea294","name":"Edit Image"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2820,1300],"id":"71310927-4b4f-4140-b1bb-47a7385c8985","name":"Extract from File"},{"parameters":{"method":"POST","url":"https://api.imgbb.com/1/upload","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiration","value":"600"},{"name":"key","value":"265fd828261f9f4c8f64f26606ab30ba"}]},"sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"image","value":"={{$('Extract from File').item.json.data}}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3020,1300],"id":"4f587463-f9b1-4f8b-bcbd-d290e6104a0b","name":"HTTP Request1"},{"parameters":{"assignments":{"assignments":[{"id":"7b86db08-e6ae-40b3-a61c-5942987d92d0","name":"prompt","value":"=Subject: The person from reference image 1.\nAttire: The specific outfit from reference image 2.\nAction: The person walks three steps forward on a neutral studio background, pauses, and then performs a slow, smooth 360-degree turn on the spot. The movement must clearly showcase the tailoring, fit, and how the fabric drapes and moves with the person's body. The action should be confident and poised.\nCamera: A stable medium full-shot follows the person as they walk. The camera holds steady during the turn, with a subtle, slow zoom out to ensure the entire outfit, including any flowing elements, remains perfectly in frame.\nStyle: Hyperrealistic, 4K, cinematic, sophisticated and clean atmosphere. Bright, even, and soft studio lighting designed to eliminate harsh shadows and highlight the texture and details of the fabric. Ultra detailed, sharp focus.\nNegative Prompt: Blurry, cartoon, deformed, disfigured, bad quality, unrealistic fabric physics, poor fit, wrinkled clothing, distracting background, watermark, text.","type":"string"},{"id":"9a8a4f43-8a7f-4d98-8fc8-fdb219901ee8","name":"duration","value":"={{ $('When Executed by Another Workflow').item.json.duration }}","type":"string"},{"id":"2ddeb560-3c20-484b-bb8c-5de3ca731d79","name":"aspect_ratio","value":"={{ $('When Executed by Another Workflow').item.json.aspect_ratio }}","type":"string"},{"id":"9b132f64-86b4-499d-97a6-f327242cc5c6","name":"openai_api_key","value":"=","type":"string"},{"id":"38bb57a3-e343-4cc5-b2d5-0f0fcad821cb","name":"input_reference","value":"={{ $('When Executed by Another Workflow').item.json.image_input[0] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2200,1280],"id":"b8af87fa-7cb2-434c-b6df-353e4038ff3d","name":"Edit Fields11"},{"parameters":{"assignments":{"assignments":[{"id":"f628b61b-e000-4b58-a9b7-47f7d1072040","name":"output","value":"={{$('Get Generation6').item.json.output}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4460,1300],"id":"58b68ce6-f54f-4bad-ae80-26866fe96cb4","name":"Edit Fields16"},{"parameters":{"content":"## Generate video with Sora 2 based on image\n","height":352,"width":2448},"type":"n8n-nodes-base.stickyNote","position":[2140,1200],"typeVersion":1,"id":"6f7b4501-148b-49df-b5d4-628a9b7ebab3","name":"Sticky Note6"},{"parameters":{"content":"### Change credentials","height":80,"width":368,"color":6},"type":"n8n-nodes-base.stickyNote","position":[3140,1520],"typeVersion":1,"id":"80bc9be5-87fd-44eb-9ddf-d0b365890740","name":"Sticky Note8"},{"parameters":{"content":"### Change credentials","height":80,"width":150,"color":6},"type":"n8n-nodes-base.stickyNote","position":[2240,1520],"typeVersion":1,"id":"435afb08-1d80-4d1a-bec3-63a9ee039a98","name":"Sticky Note9"},{"parameters":{"operation":"sendVideo","file":"={{$node[\"Replicate (–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)\"].json.output}}","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[4680,1300],"id":"659a6015-70fb-4567-b2f7-49fef5209461","name":"Send Video","webhookId":"3cdeb1f5-9ffb-46a3-aaa4-8fadabf1761e","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}},{"parameters":{"text":"–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[4840,1300],"id":"2c227034-7c9f-4541-ae8d-c60416e0c309","name":"thanks","webhookId":"2d9487ab-caf2-476c-b05a-03fe840c083c","credentials":{"telegramApi":{"id":"J3TU53OMR7GvFoqB","name":"@WeddingDres_bot"}}}],"connections":{"Telegram Trigger1":{"main":[[{"node":"update","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"token_weddingdress","type":"main","index":0}]]},"update":{"main":[[{"node":"Switch","type":"main","index":0}]]},"token_weddingdress":{"main":[[{"node":"HTTP Request4","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Telegram Trigger1","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Send welcome","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}],[{"node":"photo","type":"main","index":0}],[],[{"node":"Switch1","type":"main","index":0}]]},"Send welcome":{"main":[[]]},"Switch1":{"main":[[{"node":"Get dresses","type":"main","index":0}],[{"node":"Get suits","type":"main","index":0}],[{"node":"Send a text message","type":"main","index":0}],[{"node":"save url image","type":"main","index":0}]]},"Get dresses":{"main":[[{"node":"dress","type":"main","index":0}]]},"Get suits":{"main":[[{"node":"suit","type":"main","index":0}]]},"dress":{"main":[[{"node":"Code","type":"main","index":0}]]},"suit":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Send a cataloge","type":"main","index":0}]]},"Code":{"main":[[{"node":"Send a cataloge","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"get item","type":"main","index":0}]]},"photo":{"main":[[{"node":"ask for tails","type":"main","index":0}]]},"get item":{"main":[[{"node":"ask for photo","type":"main","index":0}]]},"ask for tails":{"main":[[{"node":"payment link","type":"main","index":0}]]},"payment link":{"main":[[{"node":"Send a payment link","type":"main","index":0}]]},"Send a payment link":{"main":[[{"node":"resume url","type":"main","index":0}]]},"resume url":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"paymnet confirmation","type":"main","index":0}]]},"Extract from File1":{"main":[[{"node":"get public url","type":"main","index":0}]]},"paymnet confirmation":{"main":[[{"node":"Get a file_id photo","type":"main","index":0}]]},"Get a file_id photo":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"get public url":{"main":[[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Generate Image1","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Get Generation","type":"main","index":0}]]},"Get Generation":{"main":[[{"node":"Switch2","type":"main","index":0}]]},"Switch2":{"main":[[],[{"node":"Edit Fields2","type":"main","index":0}],[{"node":"Wait4","type":"main","index":0}]]},"Generate Image":{"main":[[{"node":"Wait4","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"Get Generation2","type":"main","index":0}]]},"Get Generation2":{"main":[[{"node":"Switch4","type":"main","index":0}]]},"Switch4":{"main":[[],[{"node":"Edit Fields5","type":"main","index":0}],[{"node":"Wait5","type":"main","index":0}]]},"Generate Image1":{"main":[[{"node":"Wait5","type":"main","index":0}]]},"Edit Fields5":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Send Photo","type":"main","index":0}]]},"Send Photo":{"main":[[{"node":"video?","type":"main","index":0}]]},"save url image":{"main":[[{"node":"pay for video link","type":"main","index":0}]]},"send payment link video":{"main":[[{"node":"Create a record","type":"main","index":0}]]},"Create a record":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"pay for video link":{"main":[[{"node":"send payment link video","type":"main","index":0}]]},"Switch8":{"main":[[],[{"node":"Edit Fields16","type":"main","index":0}],[{"node":"Wait3","type":"main","index":0}]]},"Generate Video4":{"main":[[{"node":"If1","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Get Generation6","type":"main","index":0}]]},"Get Generation6":{"main":[[{"node":"Switch8","type":"main","index":0}]]},"If1":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"Download Image":{"main":[[{"node":"Edit Image","type":"main","index":0}]]},"Edit Image":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"Generate Video4","type":"main","index":0}]]},"Edit Fields11":{"main":[[{"node":"Download Image","type":"main","index":0}]]},"Edit Fields16":{"main":[[{"node":"Send Video","type":"main","index":0}]]},"Send Video":{"main":[[{"node":"thanks","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Edit Fields11","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"TVI3MhM0oSkJpiqY"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"versionId":"dc600202-6f66-42be-9596-f84c60e6f2cd","triggerCount":1,"shared":[{"updatedAt":"2025-10-31T19:27:01.761Z","createdAt":"2025-10-31T19:27:01.761Z","role":"workflow:owner","workflowId":"ptLQdXyDtMxoVW51","projectId":"zwyEtHn1PnfmNkEl"}],"tags":[]}
