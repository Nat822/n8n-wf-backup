{"updatedAt":"2025-08-04T16:52:27.960Z","createdAt":"2025-08-04T16:52:16.930Z","id":"aG1pyyWCHqf6BIAN","name":"invoice parsing","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"id":"4cf9ab9b-d093-425f-8f11-57f3739e2084","name":"Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1180,120]},{"parameters":{"method":"POST","url":"https://api.cloud.llamaindex.ai/api/parsing/upload","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"Bearer <your_api_key>"},{"name":"parsing_instruction","value":"Please extract invoice line items: Name, Quantity, Unit Price, Amount "}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"webhook_url","value":"<your_webhook_url>"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"},{"name":"disable_ocr","value":"true"},{"name":"disable_image_extraction","value":"True"}]},"options":{}},"id":"2320d7be-dfe7-4e50-8dfb-e1d9e21e5ded","name":"Upload File","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1420,120]},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1IC39VXU8rewBU85offxYlBd9QlYzf8S7","mode":"list","cachedResultName":"Invoices","cachedResultUrl":"https://drive.google.com/drive/folders/1IC39VXU8rewBU85offxYlBd9QlYzf8S7"},"event":"fileCreated","options":{}},"id":"f34f223f-1c6d-49ff-8da1-dc8a55c319e4","name":"Google Drive Trigger","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[980,120]},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appndgSF4faN4jPXi","mode":"list","cachedResultName":"Philipp's Base","cachedResultUrl":"https://airtable.com/appndgSF4faN4jPXi"},"table":{"__rl":true,"value":"tbloPc7Eay4Cvwysq","mode":"list","cachedResultName":"Invoices","cachedResultUrl":"https://airtable.com/appndgSF4faN4jPXi/tbloPc7Eay4Cvwysq"},"columns":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Line Items","displayName":"Line Items","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":true}]},"options":{}},"id":"ffadd445-a8cc-4df0-9134-7ed7628bdef2","name":"Create Invoice","type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1460,640]},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appndgSF4faN4jPXi","mode":"list","cachedResultName":"Philipp's Base","cachedResultUrl":"https://airtable.com/appndgSF4faN4jPXi"},"table":{"__rl":true,"value":"tblIuVR9ocAomznzK","mode":"list","cachedResultName":"Line Items","cachedResultUrl":"https://airtable.com/appndgSF4faN4jPXi/tblIuVR9ocAomznzK"},"columns":{"mappingMode":"defineBelow","value":{"Unit price":"={{ parseFloat($json.unit_price.replace('$', '').trim()) }}","Description":"={{ $json.description }}","Qty":"={{ $json.qty }}","Amount":"={{ parseFloat($json.amount.replace('$', '').trim()) }}","Invoices":"=[\"{{ $('Create Invoice').item.json.id }}\"]"},"matchingColumns":[],"schema":[{"id":"Name","displayName":"Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Qty","displayName":"Qty","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Unit price","displayName":"Unit price","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Amount","displayName":"Amount","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"Invoices","displayName":"Invoices","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false}]},"options":{}},"id":"9c04d187-af41-42dd-a925-112b163f69e4","name":"Create Line Item","type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1860,640]},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"model\": \"gpt-4o-mini\",\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": {{ JSON.stringify($('Set Fields').item.json.prompt) }}\n      },\n      {\n        \"role\": \"user\",\n        \"content\": {{ JSON.stringify( JSON.stringify($('Webhook').item.json.body.json[0].items) ) }}\n      }\n    ],\n  \"response_format\":{ \"type\": \"json_schema\", \"json_schema\":  {{ $('Set Fields').item.json.schema }}\n\n }\n  }","options":{}},"id":"1ee2ea90-5512-4851-a1b8-d94860aeed98","name":"OpenAI - Extract Line Items","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1240,640]},{"parameters":{"assignments":{"assignments":[{"id":"dc09a5b4-ff6a-4cee-b87e-35de7336ac05","name":"prompt","value":"Please, process parsed data and return only needed.","type":"string"},{"id":"4e0f9af6-517f-42af-9ced-df0e8a7118b0","name":"schema","value":"={\n  \"name\": \"generate_schema\",\n  \"description\": \"Generate schema for an array of objects representing items with their descriptions, quantities, unit prices, and amounts.\",\n  \"strict\": true,\n  \"schema\": {\n    \"type\": \"object\",\n    \"required\": [\n      \"items\"\n    ],\n    \"properties\": {\n      \"items\": {\n        \"type\": \"array\",\n        \"description\": \"Array of item objects\",\n        \"items\": {\n          \"type\": \"object\",\n          \"required\": [\n            \"description\",\n            \"qty\",\n            \"unit_price\",\n            \"amount\"\n          ],\n          \"properties\": {\n            \"description\": {\n              \"type\": \"string\",\n              \"description\": \"Description of the item\"\n            },\n            \"qty\": {\n              \"type\": \"string\",\n              \"description\": \"Quantity of the item\"\n            },\n            \"unit_price\": {\n              \"type\": \"string\",\n              \"description\": \"Unit price of the item formatted as a string\"\n            },\n            \"amount\": {\n              \"type\": \"string\",\n              \"description\": \"Total amount for the item formatted as a string\"\n            }\n          },\n          \"additionalProperties\": false\n        }\n      }\n    },\n    \"additionalProperties\": false\n  }\n}","type":"string"}]},"options":{}},"id":"058e33c1-d525-402a-aaa4-d5914b796595","name":"Set Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1020,640]},{"parameters":{"jsCode":"// Get the input from the \"OpenAI - Extract Line Items\" node\nconst input = $(\"OpenAI - Extract Line Items\").first().json;\n\n// Initialize an array for the output\nconst outputItems = [];\n\n// Navigate to the 'content' field in the choices array\nconst content = input.choices[0]?.message?.content;\n\nif (content) {\n  try {\n    // Parse the stringified JSON in the 'content' field\n    const parsedContent = JSON.parse(content);\n\n    // Extract 'items' and add them to the output array\n    if (Array.isArray(parsedContent.items)) {\n      outputItems.push(...parsedContent.items.map(i => ({ json: i })));\n    }\n  } catch (error) {\n    // Handle any parsing errors\n    console.error('Error parsing content:', error);\n  }\n}\n\n// Return the extracted items\nreturn outputItems;\n"},"id":"e5f133eb-cde5-4958-bf99-95db139060ee","name":"Process Line Items","type":"n8n-nodes-base.code","typeVersion":2,"position":[1660,640]},{"parameters":{"httpMethod":"POST","path":"0f7f5ebb-8b66-453b-a818-20cc3647c783","options":{}},"id":"4026d8e8-d682-4bfb-8b1c-ddf1f3a31d2b","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[840,640],"webhookId":"0f7f5ebb-8b66-453b-a818-20cc3647c783"},{"parameters":{"content":"## Scenario 1\n\n","height":400,"width":920},"type":"n8n-nodes-base.stickyNote","position":[800,0],"typeVersion":1,"id":"7b143731-85b7-41ea-993a-00181b40bf3b","name":"Sticky Note1"},{"parameters":{"content":"## Scenario 2\n\n","height":460,"width":1340},"type":"n8n-nodes-base.stickyNote","position":[780,540],"typeVersion":1,"id":"8f4e5b5b-f544-4263-b0ca-0381f1e5ed60","name":"Sticky Note"},{"parameters":{"content":"### Replace Google Drive connection","height":80,"width":270,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1000,300],"typeVersion":1,"id":"4b7301c9-7bfb-405a-beb1-2cfc516dfe72","name":"Sticky Note2"},{"parameters":{"content":"### Replace API key in header and Webhook address with address from 2nd scenario","height":80,"width":270,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1360,300],"typeVersion":1,"id":"00197230-161f-4ccf-ad01-2274a80fdaf4","name":"Sticky Note3"},{"parameters":{"content":"### Replace OpenAI connection","height":80,"width":170,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1200,840],"typeVersion":1,"id":"58ab76bd-e249-4089-90ec-f0ad8af5056b","name":"Sticky Note4"},{"parameters":{"content":"### Replace Airtable connection","height":80,"width":530,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1460,840],"typeVersion":1,"id":"2cdcdeb5-03e4-460c-ac01-4f75fe41b7db","name":"Sticky Note5"},{"parameters":{"content":"### ... or watch set up video [7 min]\n[![Youtube Thumbnail](https://cflobdhpqwnoisuctsoc.supabase.co/storage/v1/object/public/my_storage/Video%2010%20-%20Parser%20invoices%20Blur.png)](https://youtu.be/E4I0nru-fa8)\n","height":239.5888196628349,"width":330.5152611046425,"color":7},"id":"f2936c2e-c12f-48eb-923d-3575bc122f9a","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[300,680],"typeVersion":1},{"parameters":{"content":"![5min Logo](https://cflobdhpqwnoisuctsoc.supabase.co/storage/v1/object/public/my_storage/banner.png)\n## AI Agent for realtime insights on meetings\n**Made by [Mark Shcherbakov](https://www.linkedin.com/in/marklowcoding/) from community [5minAI](https://www.skool.com/5minai)**\n\nTranscribing meetings manually can be tedious and prone to error. This workflow automates the transcription process in real-time, ensuring that key discussions and decisions are accurately captured and easily accessible for later review, thus enhancing productivity and clarity in communications.\n\nThe workflow leverages n8n and LlamaParse to automatically detect new invoices in a designated Google Drive folder, parse essential billing details, and store the extracted data in a structured format. The key functionalities include:\n- Real-time detection of new invoices via Google Drive triggers.\n- Automated HTTP requests to initiate parsing through Lama Cloud.\n- Structured storage of invoice details and line items in a database for future reference.\n\n1. **Google Drive Integration**: Monitors a specific folder in Google Drive for new invoice uploads.\n2. **Parsing with LlamaParse**: Automatically sends invoices for parsing and processes results through webhooks.\n3. **Data Storage in Airtable**: Creates records for invoices and their associated line items, allowing for detailed tracking.","height":657,"width":636,"color":7},"id":"c6a19591-e10e-4728-8c28-8edf9454e4d4","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1},{"parameters":{"content":"### Set up steps\n\n1. **Google Drive Trigger**: \n   - Set up a trigger to detect new files in a specified folder dedicated to invoices.\n\n2. **File Upload to LlamaParse**: \n   - Create an HTTP request that sends the invoice file to LlamaParse for parsing, including relevant header settings and webhook URL.\n\n3. **Webhook Processing**: \n   - Establish a webhook node to handle parsed results from LlamaParse, extracting needed invoice details effectively.\n\n4. **Invoice Record Creation**: \n   - Create initial records for invoices in your database using the parsed details received from the webhook.\n\n5. **Line Item Processing**: \n   - Transform string data into structured line item arrays and create individual records for each item linked to the main invoice.","height":626,"width":280,"color":7},"id":"a946f090-7b8b-4d33-ab3b-d43434d400d4","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[0,680],"typeVersion":1}],"connections":{"Google Drive":{"main":[[{"node":"Upload File","type":"main","index":0}]]},"Google Drive Trigger":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Create Invoice":{"main":[[{"node":"Process Line Items","type":"main","index":0}]]},"OpenAI - Extract Line Items":{"main":[[{"node":"Create Invoice","type":"main","index":0}]]},"Set Fields":{"main":[[{"node":"OpenAI - Extract Line Items","type":"main","index":0}]]},"Process Line Items":{"main":[[{"node":"Create Line Item","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Set Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"versionId":"475b4363-2370-415d-8c2d-dd6f852ceb85","triggerCount":0,"shared":[{"updatedAt":"2025-08-04T16:52:16.930Z","createdAt":"2025-08-04T16:52:16.930Z","role":"workflow:owner","workflowId":"aG1pyyWCHqf6BIAN","projectId":"zwyEtHn1PnfmNkEl"}],"tags":[{"updatedAt":"2025-08-04T16:22:48.592Z","createdAt":"2025-08-04T16:22:48.592Z","id":"n5bEV3cSK8SadFcY","name":"N8N Template"}]}